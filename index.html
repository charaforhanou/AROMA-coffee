<head>
    <meta charset="UTF-8">
    <title>AROMA Coffee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- TensorFlow -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
</head>


<script>
    fetch("https://ipapi.co/json/")
        .then(response => response.json())
        .then(data => {
            document.getElementById("country").textContent = data.country_name;
            document.getElementById("city").textContent = data.city;
        })
        .catch(() => {
            document.getElementById("country").textContent = "Unavailable";
            document.getElementById("city").textContent = "Unavailable";
        });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // V√©rifier si c'est une nouvelle session
        if (!sessionStorage.getItem("session_active")) {
            // Nouvelle session : incr√©menter le compteur
            let visits = localStorage.getItem("test_visits");
            visits = visits ? parseInt(visits) + 1 : 1;
            localStorage.setItem("test_visits", visits);
            
            // Marquer la session comme active
            sessionStorage.setItem("session_active", "true");
        }
        
        // Afficher le nombre de visites
        let visits = localStorage.getItem("test_visits") || 1;
        document.getElementById("visits").textContent = visits;
    });
</script>



<body>

<!-- ================= HEADER ================= -->
<header class="header">
    <div class="logo">
        <img src="logoaroma.png" alt="Aroma Coffee House Logo" class="logo-img">
        <h1>Aroma</h1>
    </div>    
    <nav>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>
</header>

<!-- ================= HERO ================= -->
<section class="hero">
    <!-- ================= VISITOR CARD ================= -->
    <div class="visitor-card">
        <h3>Visitor Location</h3>
        <p><strong>Country:</strong> <span id="country">Loading...</span></p>
        <p><strong>City:</strong> <span id="city">Loading...</span></p>
        <p><strong>Visits:</strong> <span id="visits">Loading...</span></p>
    </div>
    <div class="hero-content">
        <h1>Where Every Cup Tells a Story</h1>
        <p>Discover the art of authentic coffee</p>
        <a href="menu.html" class="btn">Order Online</a>
    </div>
</section>

<!-- ================= ABOUT ================= -->
<section class="about">
    <h2>About Us</h2>
    <div class="service-card_para">
        <div class="service">
            <p class="intro">
                At <strong>AROMA</strong>, coffee is more than just a beverage ‚Äî
                it is a ritual, a moment of calm, and a source of inspiration.
            </p>
        </div>

        <div class="service">
            <p>
                Carefully selected coffee beans, roasted with precision,
                deliver rich flavors and a refined aroma in every cup.
                Coffee naturally enhances focus, boosts energy,
                supports digestion, and provides antioxidants
                that contribute to overall well-being.
            </p>
        </div>
    
        <div class="service">
            <p>
                Our space is designed to offer comfort and elegance,
                where each visit becomes a memorable experience,
                whether you seek productivity, relaxation,
                or a moment shared with others.
            </p>
        </div>
    </div>

    <!-- ================= COFFEE DETECTOR SECTION ================= -->
    <div class="coffee-detector-section">
        <div class="detector-container">
            <h2 class="detector-title">‚òï Coffee Temperature Detector</h2>
            <p class="detector-subtitle">Upload a photo to detect if your coffee is hot or cold</p>
            
            <div class="detector-loading" id="detectorLoading">
                <div class="spinner"></div>
                Loading AI model...
            </div>

            <div class="upload-area" id="uploadArea" style="display: none;">
                <span class="upload-icon">üì∏</span>
                <div class="upload-text">Click or drag to upload</div>
                <div class="upload-hint">Support: JPG, PNG, GIF</div>
                <input type="file" id="imageUpload" accept="image/*">
            </div>

            <div class="image-preview" id="imagePreview">
                <img id="coffeeImage" alt="Coffee image">
            </div>

            <div class="result-container" id="resultContainer">
                <div id="detectionResult"></div>
            </div>

            <button class="reset-btn" id="resetBtn">üîÑ Analyze Another Image</button>
        </div>
    </div>

</section>

<!-- ================= SERVICES ================= -->
<section class="services">
    <div class="service-card">‚òï Premium Coffee</div>
    <div class="service-card">üì∂ Free Wi-Fi</div>
    <div class="service-card">üåø Outdoor Terrace</div>
</section>

<!-- ================= FOOTER ================= -->
<footer>
    <p>¬© 2026 AROMA Coffee</p>
    <div class="socials">
        <a href="#">Facebook</a>
        <a href="#">Instagram</a>
        <a href="#">Twitter</a>
    </div>
</footer>

<script>
    let coffeeModel;
    const uploadArea = document.getElementById('uploadArea');
    const imageUpload = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const coffeeImage = document.getElementById('coffeeImage');
    const resultContainer = document.getElementById('resultContainer');
    const detectionResult = document.getElementById('detectionResult');
    const resetBtn = document.getElementById('resetBtn');
    const detectorLoading = document.getElementById('detectorLoading');

    // Load MobileNet model
    async function loadCoffeeModel() {
        try {
            coffeeModel = await mobilenet.load();
            detectorLoading.style.display = 'none';
            uploadArea.style.display = 'block';
        } catch (error) {
            detectorLoading.innerHTML = '‚ùå Error loading model. Please refresh the page.';
        }
    }

    loadCoffeeModel();

    // Click to upload
    uploadArea.addEventListener('click', () => imageUpload.click());

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            handleImageUpload(file);
        }
    });

    // File input change
    imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            handleImageUpload(file);
        }
    });

    // Handle image upload
    function handleImageUpload(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            coffeeImage.src = e.target.result;
            imagePreview.style.display = 'block';
            uploadArea.style.display = 'none';
            
            // Wait for image to load before analyzing
            coffeeImage.onload = () => analyzeCoffeeImage();
        };
        reader.readAsDataURL(file);
    }

    // Analyze image
    async function analyzeCoffeeImage() {
        if (!coffeeModel) return;

        resultContainer.style.display = 'block';
        detectionResult.className = '';
        detectionResult.innerHTML = '<div class="spinner"></div><p>Analyzing your coffee...</p>';

        try {
            // Get predictions
            const predictions = await coffeeModel.classify(coffeeImage, 5);
            console.log('Predictions:', predictions);

            // Keywords for detection
            const hotKeywords = ['cup', 'mug', 'espresso', 'coffee', 'cappuccino', 'latte', 'pot', 'teapot', 'coffee mug'];
            const coldKeywords = ['glass', 'ice', 'iced', 'milkshake', 'smoothie', 'frappe', 'drinking glass', 'tumbler', 'cold drink'];

            let coffeeType = 'UNKNOWN';
            let cssClass = 'unknown';
            let fillClass = 'unknown-fill';
            let icon = '‚ùì';
            let confidence = 0;
            let isCoffee = false;

            // Check predictions
            for (let pred of predictions) {
                const label = pred.className.toLowerCase();
                const prob = pred.probability;

                if (coldKeywords.some(word => label.includes(word)) && prob > 0.08) {
                    coffeeType = 'COLD COFFEE';
                    cssClass = 'cold';
                    fillClass = 'cold-fill';
                    icon = 'üßä';
                    confidence = prob * 100;
                    isCoffee = true;
                    break;
                }
                
                if (hotKeywords.some(word => label.includes(word)) && prob > 0.08) {
                    coffeeType = 'HOT COFFEE';
                    cssClass = 'hot';
                    fillClass = 'hot-fill';
                    icon = '‚òï';
                    confidence = prob * 100;
                    isCoffee = true;
                }
            }

            if (!isCoffee) {
                coffeeType = 'NO COFFEE DETECTED';
                icon = '‚ùå';
                confidence = predictions[0].probability * 100;
            }

            // Display results
            detectionResult.className = cssClass;
            detectionResult.innerHTML = `
                <div class="result-title">${icon} ${coffeeType}</div>
                <div class="confidence-bar">
                    <div class="confidence-fill ${fillClass}" style="width: ${confidence}%">
                        ${confidence.toFixed(1)}% Confidence
                    </div>
                </div>
                <div class="result-details">
                    <strong>Main Detection:</strong> ${predictions[0].className}<br>
                    <strong>Probability:</strong> ${(predictions[0].probability * 100).toFixed(2)}%
                </div>
                <div class="predictions-list">
                    <strong>Top Predictions:</strong>
                    ${predictions.slice(0, 3).map((p, i) => `
                        <div class="prediction-item">
                            ${i + 1}. ${p.className} - ${(p.probability * 100).toFixed(1)}%
                        </div>
                    `).join('')}
                </div>
            `;

            resetBtn.classList.add('show');

        } catch (error) {
            detectionResult.innerHTML = '‚ùå Error analyzing image. Please try another one.';
        }
    }

    // Reset button
    resetBtn.addEventListener('click', () => {
        imageUpload.value = '';
        imagePreview.style.display = 'none';
        resultContainer.style.display = 'none';
        uploadArea.style.display = 'block';
        resetBtn.classList.remove('show');
    });
</script>

</body>
</html>